# Telegram Client Search Bot

Бот на Node.js, который ищет клиентов в таблице `Клиенты.xlsx` и выдаёт топ-5 совпадений с данными «Клиент — Менеджер — Код».

## Подготовка

1. Убедитесь, что в `.env` заданы переменные:
   - `BOT_TOKEN` — токен вашего Telegram-бота;
   - `DATA_SECRET` — 32-байтовый ключ в base64 для шифрования данных (`openssl rand -base64 32`);
   - опционально `USE_WEBHOOK` / `WEBHOOK_URL` / `PORT` (см. раздел про деплой).
2. Установите зависимости:

   ```bash
   npm install
   ```

3. После каждого обновления `Клиенты.xlsx` выполните экспорт и шифрование:

   ```bash
   npm run export-data
   ```

   Скрипт создаст `data/encrypted_clients.json`, который бот будет читать в рантайме.

4. Запустите бота локально (long polling):

   ```bash
   npm run start
   ```

## Доступ

Перед первым поиском пользователь должен отправить боту код доступа `22170313`. После подтверждения бот запоминает пользователя и разрешает искать клиентов.

## Поиск

Отправьте название клиента, фамилию менеджера или код — бот вернёт до 5 ближайших совпадений.

Команда `/reload` доступна авторизованным пользователям и перезагружает данные из зашифрованного JSON без перезапуска бота.

## Деплой на Render

- **Worker (рекомендовано для long polling)**: создайте Background Worker и оставьте `USE_WEBHOOK` пустым или `false`. Render не требует открывать порт.
- **Web Service (через вебхуки)**:
  1. Настройте переменные окружения `USE_WEBHOOK=true`, `WEBHOOK_URL=https://<ваш-домен>`, `PORT=10000` (или значение по умолчанию Render).
  2. Запустите веб-сервис с командой `npm run start`.
  3. Render увидит открытый порт, а бот будет получать апдейты по webhook.

